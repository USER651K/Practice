8ELSEIF vbkd-bstkd IS NOT INITIAL.
***BOC--UJWAL--10.02.2026--PO Number - WADAT from VBEP via Sales Order
            " Clear all PO related variables
            CLEAR: gv_planned_gi, deliv_ord, sale_ord, ls_fval.
            CLEAR: gt_del_wadat, gt_lips_del.
            REFRESH: gt_del_wadat, gt_lips_del, lt_fval.

            " Step 1: Get Deliveries from LIPS using PO Number
            SELECT DISTINCT vbeln
              FROM lips
              INTO TABLE gt_lips_del
              WHERE vgbel = vbkd-bstkd.

            IF sy-subrc = 0 AND gt_lips_del IS NOT INITIAL.
              " Step 2: Get Deliveries from LIKP (for dropdown list)
              SELECT vbeln wadat
                FROM likp
                INTO TABLE gt_del_wadat
                FOR ALL ENTRIES IN gt_lips_del
                WHERE vbeln = gt_lips_del-vbeln.

              IF sy-subrc = 0 AND gt_del_wadat IS NOT INITIAL.
                SORT gt_del_wadat BY vbeln.
                DELETE ADJACENT DUPLICATES FROM gt_del_wadat COMPARING vbeln.

                " Set initial delivery
                READ TABLE gt_del_wadat INTO gs_del_wadat INDEX 1.
                IF sy-subrc = 0.
                  lv_delivery = gs_del_wadat-vbeln.
                  deliv_ord = gs_del_wadat-vbeln.

                  " Step 3: Get Sales Order from VBFA using Delivery
                  SELECT SINGLE vbelv
                    FROM vbfa INTO sale_ord
                    WHERE vbeln = gs_del_wadat-vbeln
                    AND vbtyp_v = 'C'.

                  " Step 4: Get WADAT from VBEP using Sales Order (SAME AS SALES DOCUMENT)
                  IF sale_ord IS NOT INITIAL.
                    SELECT SINGLE wadat
                      FROM vbep INTO gv_planned_gi
                      WHERE vbeln = sale_ord.
                  ENDIF.
                ENDIF.

                " Populate Delivery dropdown
                LOOP AT gt_del_wadat INTO gs_del_wadat.
                  ls_fval-key  = gs_del_wadat-vbeln.
                  ls_fval-text = gs_del_wadat-vbeln.
                  APPEND ls_fval TO lt_fval.
                ENDLOOP.

                CALL FUNCTION 'VRM_SET_VALUES'
                  EXPORTING
                    id     = 'DELIV_ORD'
                    values = lt_fval.
              ENDIF.
            ENDIF.

            " Fallback: If no delivery found in LIPS
            IF gt_del_wadat IS INITIAL.
              CLEAR: gt_del_wadat, gt_lips_del, deliv_ord.
              REFRESH: lt_fval.

              " Clear dropdown
              CALL FUNCTION 'VRM_SET_VALUES'
                EXPORTING
                  id     = 'DELIV_ORD'
                  values = lt_fval.

              SELECT SINGLE vbeln
                FROM vbkd INTO lv_ord
                WHERE bstkd = vbkd-bstkd.

              IF sy-subrc = 0.
                wa_ysdssop-sales_order = lv_ord.
                sale_ord = lv_ord.

                SELECT SINGLE vbeln
                  FROM vbfa INTO lv_delivery
                  WHERE vbelv = lv_ord
                  AND vbtyp_n = 'J'.

                " Fallback also uses VBEP via Sales Order
                IF sale_ord IS NOT INITIAL.
                  SELECT SINGLE wadat
                    FROM vbep INTO gv_planned_gi
                    WHERE vbeln = sale_ord.
                ENDIF.
              ENDIF.
            ENDIF.
***EOC--UJWAL--10.02.2026--PO Number - WADAT from VBEP via Sales Order














ELSEIF vbkd-bstkd IS NOT INITIAL.
***BOC--UJWAL--10.02.2026--PO Number - WADAT from VBEP via Sales Order
          " Clear all PO related variables
          CLEAR: gv_planned_gi, deliv_ord, sale_ord.
          CLEAR: gt_del_wadat, gt_lips_del.
          REFRESH: gt_del_wadat, gt_lips_del.

          " Step 1: Get Deliveries from LIPS using PO Number
          SELECT DISTINCT vbeln
            FROM lips
            INTO TABLE gt_lips_del
            WHERE vgbel = vbkd-bstkd.

          IF sy-subrc = 0 AND gt_lips_del IS NOT INITIAL.
            " Step 2: Get Deliveries from LIKP (for dropdown list only)
            SELECT vbeln wadat
              FROM likp
              INTO TABLE gt_del_wadat
              FOR ALL ENTRIES IN gt_lips_del
              WHERE vbeln = gt_lips_del-vbeln.

            IF sy-subrc = 0 AND gt_del_wadat IS NOT INITIAL.
              SORT gt_del_wadat BY vbeln.
              DELETE ADJACENT DUPLICATES FROM gt_del_wadat COMPARING vbeln.

              " Set initial delivery
              READ TABLE gt_del_wadat INTO gs_del_wadat INDEX 1.
              IF sy-subrc = 0.
                lv_del = gs_del_wadat-vbeln.
                deliv_ord = gs_del_wadat-vbeln.

                " Step 3: Get Sales Order from VBFA using Delivery
                SELECT SINGLE vbelv
                  FROM vbfa INTO sale_ord
                  WHERE vbeln = gs_del_wadat-vbeln
                  AND vbtyp_v = 'C'.

                " Step 4: Get WADAT from VBEP using Sales Order (SAME AS SALES DOCUMENT)
                IF sale_ord IS NOT INITIAL.
                  SELECT SINGLE wadat
                    FROM vbep INTO gv_planned_gi
                    WHERE vbeln = sale_ord.
                ENDIF.
              ENDIF.
            ENDIF.
          ENDIF.

          " Fallback: If no delivery found in LIPS
          IF gt_del_wadat IS INITIAL.
            CLEAR: gt_del_wadat, gt_lips_del, deliv_ord.
            SELECT SINGLE vbeln
              FROM vbkd INTO lv_ord
              WHERE bstkd = vbkd-bstkd.
            IF sy-subrc = 0.
              sale_ord = lv_ord.
              SELECT SINGLE vbeln
                FROM vbfa INTO lv_del
                WHERE vbelv = lv_ord
                AND vbtyp_n = 'J'.
              " Fallback also uses VBEP via Sales Order
              IF sale_ord IS NOT INITIAL.
                SELECT SINGLE wadat
                  FROM vbep INTO gv_planned_gi
                  WHERE vbeln = sale_ord.
              ENDIF.
            ENDIF.
          ENDIF.
***EOC--UJWAL--10.02.2026--PO Number - WADAT from VBEP via Sales Order











***BOC--UJWAL--10.02.2026--PO Delivery Dropdown Handler - WADAT from VBEP
  " Handle Delivery dropdown change for PO Number
  IF vbkd-bstkd IS NOT INITIAL.
    IF gt_del_wadat IS NOT INITIAL AND deliv_ord IS NOT INITIAL.
      " Step 1: Get Sales Order for selected Delivery
      SELECT SINGLE vbelv
        FROM vbfa INTO sale_ord
        WHERE vbeln = deliv_ord
        AND vbtyp_v = 'C'.

      " Step 2: Get WADAT from VBEP using Sales Order (SAME AS SALES DOCUMENT)
      IF sale_ord IS NOT INITIAL.
        SELECT SINGLE wadat
          FROM vbep INTO gv_planned_gi
          WHERE vbeln = sale_ord.
      ELSE.
        CLEAR: gv_planned_gi, sale_ord.
      ENDIF.
    ENDIF.
  ENDIF.
***EOC--UJWAL--10.02.2026--PO Delivery Dropdown Handler - WADAT from VBEP























ELSEIF vbkd-bstkd IS NOT INITIAL.
***BOC--UJWAL--10.02.2026--PO Number - Single SO with WADAT from VBEP
          CLEAR: gv_planned_gi, sale_ord, lv_del.
          DATA: lv_so_cnt TYPE i.

          " Count Sales Orders for this Customer PO
          SELECT COUNT(*) FROM vbkd INTO lv_so_cnt
            WHERE bstkd = vbkd-bstkd.

          IF lv_so_cnt > 1.
            " Multiple Sales Orders - Show error
            MESSAGE 'Multiple Sales Orders found. Search with another reference.' TYPE 'I'.
            CLEAR: sale_ord, gv_planned_gi.
          ELSEIF lv_so_cnt = 1.
            " Single Sales Order - Proceed
            SELECT SINGLE vbeln
              FROM vbkd INTO lv_ord
              WHERE bstkd = vbkd-bstkd.

            IF sy-subrc = 0.
              sale_ord = lv_ord.

              " Get WADAT from VBEP (Same as Sales Document)
              SELECT SINGLE wadat
                FROM vbep INTO gv_planned_gi
                WHERE vbeln = lv_ord.

              " Get Delivery for GI check
              SELECT SINGLE vbeln
                FROM vbfa INTO lv_del
                WHERE vbelv = lv_ord
                AND vbtyp_n = 'J'.
            ENDIF.
          ENDIF.
***EOC--UJWAL--10.02.2026--PO Number - Single SO with WADAT from VBEP

















ELSEIF vbkd-bstkd IS NOT INITIAL.
***BOC--UJWAL--10.02.2026--PO Number - Single SO with WADAT from VBEP
            CLEAR: gv_planned_gi, sale_ord, lv_delivery.
            DATA: lv_so_count TYPE i.

            " Count Sales Orders for this Customer PO
            SELECT COUNT(*) FROM vbkd INTO lv_so_count
              WHERE bstkd = vbkd-bstkd.

            IF lv_so_count > 1.
              " Multiple Sales Orders - Show error
              MESSAGE 'Multiple Sales Orders found. Search with another reference.' TYPE 'I'.
              CLEAR: wa_ysdssop-sales_order, sale_ord, gv_planned_gi.
            ELSEIF lv_so_count = 1.
              " Single Sales Order - Proceed
              SELECT SINGLE vbeln
                FROM vbkd INTO lv_ord
                WHERE bstkd = vbkd-bstkd.

              IF sy-subrc = 0.
                wa_ysdssop-sales_order = lv_ord.
                sale_ord = lv_ord.

                " Get WADAT from VBEP (Same as Sales Document)
                SELECT SINGLE wadat
                  FROM vbep INTO gv_planned_gi
                  WHERE vbeln = lv_ord.

                " Get Delivery for GI check
                SELECT SINGLE vbeln
                  FROM vbfa INTO lv_delivery
                  WHERE vbelv = lv_ord
                  AND vbtyp_n = 'J'.
              ENDIF.
            ELSE.
              " No Sales Order found
              MESSAGE 'Purchase Order does not exist' TYPE 'I'.
            ENDIF.
***EOC--UJWAL--10.02.2026--PO Number - Single SO with WADAT from VBEP









ELSEIF likp-vbeln IS NOT INITIAL.
***BOC--UJWAL--10.02.2026--Delivery - Get SO from VBFA, WADAT from VBEP
            lv_delivery = likp-vbeln.

            " Step 1: Get Sales Order from VBFA using Delivery
            SELECT SINGLE vbelv
              FROM vbfa INTO lv_ord
              WHERE vbeln = likp-vbeln
              AND vbtyp_v = 'C'.

            IF sy-subrc = 0 AND lv_ord IS NOT INITIAL.
              wa_ysdssop-sales_order = lv_ord.
              sale_ord = lv_ord.

              " Step 2: Get WADAT from VBEP (Same as Sales Document)
              SELECT SINGLE wadat
                FROM vbep INTO gv_planned_gi
                WHERE vbeln = lv_ord.
            ENDIF.
***EOC--UJWAL--10.02.2026--Delivery - Get SO from VBFA, WADAT from VBEP






ELSEIF likp-vbeln IS NOT INITIAL.
***BOC--UJWAL--10.02.2026--Delivery - Get SO from VBFA, WADAT from VBEP
          lv_del = likp-vbeln.

          " Step 1: Get Sales Order from VBFA using Delivery
          SELECT SINGLE vbelv
            FROM vbfa INTO lv_ord
            WHERE vbeln = likp-vbeln
            AND vbtyp_v = 'C'.

          IF sy-subrc = 0 AND lv_ord IS NOT INITIAL.
            sale_ord = lv_ord.

            " Step 2: Get WADAT from VBEP (Same as Sales Document)
            SELECT SINGLE wadat
              FROM vbep INTO gv_planned_gi
              WHERE vbeln = lv_ord.
          ENDIF.
***EOC--UJWAL--10.02.2026--Delivery - Get SO from VBFA, WADAT from VBEP
```

---

## Summary - All Input Types

| Input | Step 1 | Step 2 | Step 3 |
|-------|--------|--------|--------|
| **Sales Doc** | Direct use as SO | VBEP → WADAT | VBFA → Delivery |
| **Delivery** | VBFA (VBTYP_V='C') → SO | VBEP → WADAT | - |
| **PO Number** | VBKD → SO (count check) | VBEP → WADAT | VBFA → Delivery |

---

## Flow Diagram - Delivery
```
Delivery (LIKP-VBELN)
       │
       ▼
VBFA: WHERE vbeln = Delivery AND vbtyp_v = 'C'
       │
       ▼
Get VBELV → Sales Order (sale_ord)
       │
       ▼
VBEP: WHERE vbeln = Sales Order
       │
       ▼
Get WADAT → gv_planned_gi (Planned GI Date)
















REPORT ztest_tvarvc.

DATA: lt_tvarvc TYPE STANDARD TABLE OF tvarvc,
      ls_tvarvc TYPE tvarvc.

PARAMETERS: p_gsber TYPE gsber DEFAULT '5003'.

SELECT * FROM tvarvc INTO TABLE lt_tvarvc
  WHERE name LIKE 'ZFI_PUNJAB%'.

IF lt_tvarvc[] IS INITIAL.
  WRITE: / '*** NO TVARVC ENTRIES FOUND AT ALL ***'.
ELSE.
  LOOP AT lt_tvarvc INTO ls_tvarvc.
    WRITE: / 'NAME:', ls_tvarvc-name,
           / 'TYPE:', ls_tvarvc-type,
           / 'LOW:',  ls_tvarvc-low,
           / 'SIGN:', ls_tvarvc-sign,
           / 'OPTI:', ls_tvarvc-opti,
           / '---'.
    
    " Test comparison
    IF p_gsber = ls_tvarvc-low.
      WRITE: / '>>> MATCH with direct compare'.
    ENDIF.
    
    IF ls_tvarvc-low CS p_gsber.
      WRITE: / '>>> MATCH with CS (contains string)'.
    ENDIF.
  ENDLOOP.
ENDIF.












FORM get_baseline_date
  USING    p_gsber  TYPE gsber
           p_tr_no  TYPE char10
  CHANGING p_zfbdt  TYPE bsik-zfbdt.

  DATA: lv_in_set        TYPE char1,
        lv_grnob_date    TYPE zp2pttruck-grnobdate,
        lv_zp2pdeoffr    TYPE zp2pttruck-zp2pdepoffr,
        lv_creation_date TYPE zp2ptpurofr-creation_date,
        lv_setid         TYPE setid.

  CLEAR: p_zfbdt, lv_in_set.

  " Read Set ZFI_PUNJAB_PLANT values
  CLEAR gt_gsber_set.
  REFRESH gt_gsber_set.

  " Step 1: Get numeric Set ID from name
  CALL FUNCTION 'G_SET_GET_ID_FROM_NAME'
    EXPORTING
      shortname = 'ZFI_PUNJAB_PLANT'
    IMPORTING
      new_setid = lv_setid
    EXCEPTIONS
      OTHERS    = 1.

  IF sy-subrc = 0.
    " Step 2: Get all values using numeric ID
    CALL FUNCTION 'G_SET_GET_ALL_VALUES'
      EXPORTING
        setnr      = lv_setid
      TABLES
        set_values = gt_gsber_set
      EXCEPTIONS
        OTHERS     = 1.

    IF sy-subrc = 0.
      " Check if current GSBER is in the set
      LOOP AT gt_gsber_set INTO gs_gsber_set.
        IF gs_gsber_set-from = p_gsber.
          lv_in_set = 'X'.
          EXIT.
        ENDIF.
      ENDLOOP.
    ENDIF.
  ENDIF.

  IF lv_in_set = 'X'.
    "------------------------------------------------------------
    " Punjab Plant - Get GRNOB_DATE from ZP2PTTRUCK
    "------------------------------------------------------------
    SELECT SINGLE grnobdate
      FROM zp2pttruck
      INTO lv_grnob_date
      WHERE zp2pdetrno = p_tr_no.

    IF sy-subrc = 0 AND lv_grnob_date IS NOT INITIAL.
      p_zfbdt = lv_grnob_date.
    ELSE.
      p_zfbdt = sy-datum.
    ENDIF.

  ELSE.
    "------------------------------------------------------------
    " Other Plants - Get creation_date from ZP2PTPUROFR
    "------------------------------------------------------------
    SELECT SINGLE zp2pdepoffr
      FROM zp2pttruck
      INTO lv_zp2pdeoffr
      WHERE zp2pdetrno = p_tr_no.

    IF sy-subrc = 0 AND lv_zp2pdeoffr IS NOT INITIAL.
      SELECT SINGLE creation_date
        FROM zp2ptpurofr
        INTO lv_creation_date
        WHERE pur_offer = lv_zp2pdeoffr.

      IF sy-subrc = 0 AND lv_creation_date IS NOT INITIAL.
        p_zfbdt = lv_creation_date.
      ELSE.
        p_zfbdt = sy-datum.
      ENDIF.
    ELSE.
      p_zfbdt = sy-datum.
    ENDIF.
  ENDIF.

ENDFORM.














REPORT ztest_set_read.

DATA: gt_set    TYPE STANDARD TABLE OF rgsb4,
      gs_set    TYPE rgsb4,
      lv_setid  TYPE setid,
      lv_gsber  TYPE rgsb4-from.

PARAMETERS: p_gsber TYPE gsber DEFAULT '5003'.

" Step 1: Get ID
CALL FUNCTION 'G_SET_GET_ID_FROM_NAME'
  EXPORTING
    shortname = 'ZFI_PUNJAB_PLANT'
    tabname   = 'T001W'
    fieldname = 'WERKS'
  IMPORTING
    new_setid = lv_setid
  EXCEPTIONS
    OTHERS    = 1.

IF sy-subrc <> 0.
  WRITE: / '*** G_SET_GET_ID_FROM_NAME FAILED ***'.
  WRITE: / 'SY-SUBRC:', sy-subrc.
  RETURN.
ENDIF.

WRITE: / 'Set ID found:', lv_setid.

" Step 2: Get values
CALL FUNCTION 'G_SET_GET_ALL_VALUES'
  EXPORTING
    setnr      = lv_setid
  TABLES
    set_values = gt_set
  EXCEPTIONS
    OTHERS     = 1.

IF sy-subrc <> 0.
  WRITE: / '*** G_SET_GET_ALL_VALUES FAILED ***'.
  RETURN.
ENDIF.

WRITE: / 'Values found:', lines( gt_set ).
ULINE.

" Step 3: Show values and check match
lv_gsber = p_gsber.

LOOP AT gt_set INTO gs_set.
  WRITE: / 'FROM:', gs_set-from, 'TO:', gs_set-to.
  IF gs_set-from = lv_gsber.
    WRITE: '  >>> MATCH!'.
  ENDIF.
ENDLOOP.














FORM get_baseline_date
  USING    p_gsber  TYPE gsber
           p_tr_no  TYPE char10
  CHANGING p_zfbdt  TYPE bsik-zfbdt.

  DATA: lv_in_set        TYPE char1,
        lv_grnob_date    TYPE zp2pttruck-grnobdate,
        lv_zp2pdeoffr    TYPE zp2pttruck-zp2pdepoffr,
        lv_creation_date TYPE zp2ptpurofr-creation_date,
        lv_setid         TYPE setid,
        lv_gsber_str     TYPE rgsb4-from.  " Same type as set value

  CLEAR: p_zfbdt, lv_in_set.

  " Step 1: Get Set ID from Name
  " Set is defined on Table T001W, Field WERKS
  CALL FUNCTION 'G_SET_GET_ID_FROM_NAME'
    EXPORTING
      shortname = 'ZFI_PUNJAB_PLANT'
      tabname   = 'T001W'
      fieldname = 'WERKS'
    IMPORTING
      new_setid = lv_setid
    EXCEPTIONS
      set_not_found         = 1
      table_field_not_found = 2
      OTHERS                = 3.

  IF sy-subrc = 0.

    " Step 2: Get all values using Set ID
    CLEAR gt_gsber_set.
    REFRESH gt_gsber_set.

    CALL FUNCTION 'G_SET_GET_ALL_VALUES'
      EXPORTING
        setnr      = lv_setid
      TABLES
        set_values = gt_gsber_set
      EXCEPTIONS
        set_not_found = 1
        OTHERS        = 2.

    IF sy-subrc = 0.
      " Step 3: Compare GSBER against set values
      " RGSB4-FROM is CHAR(45), GSBER is CHAR(4)
      " Convert GSBER to same type for clean comparison
      lv_gsber_str = p_gsber.

      LOOP AT gt_gsber_set INTO gs_gsber_set.
        IF gs_gsber_set-from = lv_gsber_str.
          lv_in_set = 'X'.
          EXIT.
        ENDIF.
      ENDLOOP.
    ENDIF.

  ENDIF.

  IF lv_in_set = 'X'.
    "------------------------------------------------------------
    " Punjab Plant - Get GRNOB_DATE from ZP2PTTRUCK
    "------------------------------------------------------------
    SELECT SINGLE grnobdate
      FROM zp2pttruck
      INTO lv_grnob_date
      WHERE zp2pdetrno = p_tr_no.

    IF sy-subrc = 0 AND lv_grnob_date IS NOT INITIAL.
      p_zfbdt = lv_grnob_date.
    ELSE.
      p_zfbdt = sy-datum.
    ENDIF.

  ELSE.
    "------------------------------------------------------------
    " Other Plants - Get creation_date from ZP2PTPUROFR
    "------------------------------------------------------------
    SELECT SINGLE zp2pdepoffr
      FROM zp2pttruck
      INTO lv_zp2pdeoffr
      WHERE zp2pdetrno = p_tr_no.

    IF sy-subrc = 0 AND lv_zp2pdeoffr IS NOT INITIAL.
      SELECT SINGLE creation_date
        FROM zp2ptpurofr
        INTO lv_creation_date
        WHERE pur_offer = lv_zp2pdeoffr.

      IF sy-subrc = 0 AND lv_creation_date IS NOT INITIAL.
        p_zfbdt = lv_creation_date.
      ELSE.
        p_zfbdt = sy-datum.
      ENDIF.
    ELSE.
      p_zfbdt = sy-datum.
    ENDIF.
  ENDIF.

ENDFORM.

















LOOP AT gt_bsik_temp INTO gs_bsik_temp.
    CLEAR: lv_orig_blart, lv_vendor_name, lv_mandi, lv_payment_reason,
           lv_days, lv_payment_due_date, lv_zuonr_10, gs_credit, 
           lv_cd_pct, lv_cd_days, lv_grace_days, lv_net_days.

    CLEAR: lt_cellstyle, ls_cellstyle.
    REFRESH lt_cellstyle.

    "========== DEBUG START ==========
    WRITE: / '>>> Processing:', 
             'BELNR=', gs_bsik_temp-belnr, 
             'BUZEI=', gs_bsik_temp-buzei,
             'BLART=', gs_bsik_temp-blart,
             'REBZG=', gs_bsik_temp-rebzg,
             'REBZJ=', gs_bsik_temp-rebzj,
             'GSBER=', gs_bsik_temp-gsber.
    "========== DEBUG END ============





" CONTINUE Point 1: TR Filter
    lv_zuonr_10 = gs_bsik_temp-zuonr(10).
    IF s_trno[] IS NOT INITIAL.
      IF NOT lv_zuonr_10 IN s_trno.
        WRITE: / '*** SKIPPED at TR Filter:', gs_bsik_temp-belnr, gs_bsik_temp-buzei.
      ENDIF.
      CHECK lv_zuonr_10 IN s_trno.
    ENDIF.

    " CONTINUE Point 2: AB Document Check
    IF gs_bsik_temp-blart = 'AB'.
      READ TABLE gt_bkpf INTO gs_bkpf
        WITH KEY bukrs = gs_bsik_temp-bukrs
                 belnr = gs_bsik_temp-rebzg
                 gjahr = gs_bsik_temp-rebzj
        BINARY SEARCH.
      IF sy-subrc = 0.
        lv_orig_blart = gs_bkpf-blart.
      ENDIF.
      IF lv_orig_blart <> 'RE' AND lv_orig_blart <> 'KR'.
        WRITE: / '*** SKIPPED at AB Check:', gs_bsik_temp-belnr, gs_bsik_temp-buzei,
                 'REBZG=', gs_bsik_temp-rebzg, 'orig_blart=', lv_orig_blart.
        CONTINUE.
      ENDIF.
    ENDIF.

    " ... vendor name (no CONTINUE) ...

    " CONTINUE Point 3: Mandi
    READ TABLE gt_mandi INTO gs_mandi
      WITH KEY zp2pdetrno = lv_zuonr_10
      BINARY SEARCH.
    IF sy-subrc = 0.
      lv_mandi = gs_mandi-zp2pdemandi.
    ELSE.
      WRITE: / '*** SKIPPED at Mandi:', gs_bsik_temp-belnr, gs_bsik_temp-buzei.
      CONTINUE.
    ENDIF.

    " CONTINUE Point 4: Mandi Selection
    IF s_zp2p[] IS NOT INITIAL.
      IF NOT lv_mandi IN s_zp2p.
        WRITE: / '*** SKIPPED at Mandi Filter:', gs_bsik_temp-belnr, gs_bsik_temp-buzei.
      ENDIF.
      CHECK lv_mandi IN s_zp2p.
    ENDIF.

    " ... CD Terms lookups ...
    " CONTINUE Point 5: No CD Terms
        WRITE: / '*** SKIPPED at CD Terms:', gs_bsik_temp-belnr, gs_bsik_temp-buzei.
        CONTINUE.








"========== DEBUG: ROW ADDED ==========
    WRITE: / '>>> APPENDED:', gs_bsik_temp-belnr, gs_bsik_temp-buzei,
             'PayAmt=', gs_credit-payment_amt, 'CD=', gs_credit-applicable_cd_amt.
    "======================================

    APPEND gs_credit TO gt_credit.
  ENDLOOP.

